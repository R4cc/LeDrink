@page "/admin"
@using LeDrink.DAL.Data
@using LeDrink.DAL.Interfaces
@using System.Diagnostics
@inject Radzen.NotificationService NotificationService
@inject IUnitOfWork _uow

<!-- lol leiche bruder -NL -->

<PageTitle>Lé Drink - Admin</PageTitle>

@if(isAuthenticated)
{
    <div class="container">
        <div class="row" >
            <Title Type="1">Admin Settings</Title>
        </div>
        <div class="row" >
                <Button Shape="@ButtonShape.Round" Type="@AntDesign.ButtonType.Primary" Class="w-100" @onclick="Flush">Flush</Button>
        </div>        
        <div class="row" >
                <Button Shape="@ButtonShape.Round" Type="@AntDesign.ButtonType.Primary" Class="w-100" @onclick="RebootPi">Reboot Raspberrypi</Button>
        </div>
        
    </div>
}
else
{
    <div class="container-fluid">
  <div class="row d-flex justify-content-center align-items-center m-0" style="height: 100vh;">
    <div class="login_oueter">
      <div class="col-md-12 logo_outer">
        <RadzenImage Path="big_logo.svg"/>
      </div>
      <form action="" method="post" id="login" autocomplete="off" class="bg-light border p-3">
        <div class="form-row">
          <h4 class="title my-3">Login For Access</h4>
          <div class="col-12">
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1"><i class="fas fa-user"></i></span>
              </div>
              <input name="username" @bind="@inputUsername" type="text" class="input form-control" id="username" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1" />
            </div>
          </div>
          <div class="col-12">
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1"><i class="fas fa-lock"></i></span>
              </div>
              <input name="password" type="password" @bind="@inputPassword" class="input form-control" id="password" placeholder="password" required="true" aria-label="password" aria-describedby="basic-addon1" />
              <div class="input-group-append">
                <span class="input-group-text" onclick="password_show_hide();">
                  <i class="fas fa-eye" id="show_eye"></i>
                  <i class="fas fa-eye-slash d-none" id="hide_eye"></i>
                </span>
              </div>
            </div>
          </div>
          <div class="col-6">
          </div>
          <div class="col-12">
            <Button OnClick="Login">Login</Button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
}


<style>
.login_oueter {
    width: 360px;
    max-width: 100%;
}
.logo_outer{
    text-align: center;
}
.logo_outer img{
    width:120px;
    margin-bottom: 40px;
}

</style>


@code {
    private bool isAuthenticated = false;
    private string adminUsername = "admin";
    private string adminPassword = "Drink1234";    

    private string inputUsername = "";
    private string inputPassword = "";

    private async Task Login()
    {
        if(inputUsername.ToLower() == adminUsername && inputPassword == adminPassword)
        {
            isAuthenticated = true;
        }
        else
        {
            ShowError("Invaid Username and Password!");
        }
    }

    private void ShowError(string Message)
    {
        NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Error, Summary = Message, Duration = 4000 });
    }

    private async Task Flush()
    {
        await _uow.RaspiRepo.Flush();
    }

    private async Task RebootPi()
    {
        System.Diagnostics.Process.Start(new ProcessStartInfo() {FileName = "sudo", Arguments = "reboot"});
    }
}
